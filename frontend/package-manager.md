## 패키지 매니저란?

- 패키지를 다루는 작업을 편리하고 안전하게 수행하기 위해 사용되는 툴
- 즉, 패키지 설치, 업데이트, 수정, 삭제 작업을 용이하게 해줌
- 패키지는 아래 3가지 정보를 갖고 있는 코드의 배포 단위
  1. 컴파일한 소프트웨어
  2. 환경 설정에 관련된 정보
  3. 의존(dependency)에 관련된 정보

## 의존? dependency?

- 많은 패키지들은 다른 패키지가 설치되어 있어야만 제대로 동작함
- 이 경우, 기존 패키지를 제대로 동작시키기 위해 필요한 다른 패키지를 dependency라고 말함.
- 따라서 패키지를 사용할 때 dependency에 해당되는 다른 패키지들을 전부 설치해야 함.
- dependency의 dependency를 설치하는 경우가 생기며, 이런 상황이 끊임없이 이어질 경우 사용자가 수동으로 패키지를 관리하는게 굉장히 어려워짐. dependency hell이라고 함.
- 따라서 각각의 패키지가 자신의 dependency에 대한 정보를 갖게 한다면, 사용자가 사용하고자 하는 패키지의 dependency를 패키지 매니저를 통해 쉽게 설치하도록 도와줌

## 패키지 매니저가 하는 역할

- 패키지 dependency 관리
- 패키지 보안관리 → 신뢰할 수 있고, 손상되지 않음을 보장
- 여러 패키지를 기능에 따라 그룹으로 묶어 정리
- 패키지 압축 해제
- Software Repository로부터 패키지를 찾고, 다운하고, 설치하고, 업데이트 하는 역할

## npm

- Node Package Manager의 줄임말
- 노드를 설치할 때 자동으로 설치되는 기본 패키지 관리자.
- npm도 버전이 올라가면서 많은 부분이 개선됨.
  - 버전 장금을 위해 package-lock.json 파일을 사용함

## yarn classic (ver 1)

- 2016년 페이스북에서 개발함
- npm 레지스트리와 호환하면서 속도나 안정성 측면에서 npm보다 향상됨
- 캐시를 사용하여 한 번 다운로드 한 패키지라면 그 다음부터는 빠른 속도로 설치 가능
- 버전 장금을 위해 yarn.lock 파일을 사용함
- yarn classic은 공식적으로 더 이상 기능 추가가 없다고 공식 발표함

## 유령 의존성

- npm과 yarn은 node_modules 내부의 중복된 패키지를 최소화하기 위해 각 패키지가 의존하고 있는 패키지들을 최상단으로 끌어올림 (호이스팅)
- 이렇게 될 경우, 내가 설치한 패키지가 의존하고 있다는 이유로 직접 설치한 적이 없는 패키지도 쓸 수 있음
- 이를 유령 의존성이라고 함

## yarn berry (ver 2)

- Plug n Play라고 불리는 방식: 프로젝트의 node_modules 디렉토리에 패키지를 저장하지 않음.
- 기존의 무거웠던 node_modules 대신 패키지들에 대한 정보는 .zip 파일로 압축하여 .yarn/cache 폴더에 저장하고 이를 착기 위한 정보를 .pnp.cjs 파일에 기록함.
- 별도의 I/O 작업 없이도 패키지의 위치를 정확히 알 수 있어서 시간도 단축되고 중복 설치를 방시하며 node_modules를 만들고 패키지를 호이스팅 시킬 필요가 없음 (유령 의존성 문제 해결)
- zero install: pnp 전략으로 무거웠던 node_modules를 획기적으로 제거하고 옮긴 덕분에 이를 이용해 의존성까지 github에 올릴 수 있게 됨. yarn berry를 통해 만든 의존성 폴더는 어지간하면 200mb를 넘지 않음. 덕분에 git clone 이후 별도의 설치가 필요 없이 바로 사용할 수 있도록 하는 zero-install을 시도해 볼 수 있음.
- zero install를 사용할 경우 CI/CD 파이프라인을 구축하면 더 큰 효과를 볼 수 있음. clone이 끝나자마자 곧바로 빌드가 가능해져서 배포까지 걸리는 속도가 대폭 단축됨

## pnpm

- 2017년에 처음 소개되었으며, npm을 대체하기 위한 더 빠르고 효율적인 패키지 매니저를 목표로 함
- 패키지를 설치할 때 직접적으로 설치하는 방법 대신 심링크(하드링크)를 사용함.
- lodash를 사용하는 패키지 100개가 있으면, npn/yarn을 사용할 경우 각 폴더별로 lodash 패키지가 100개가 복사됨
- 반면 pnpm은 lodash를 한번만 설치하고 다른 100개의 프로젝트에는 심링크로 연결하여 용량 측면에서 효율적으로 패키지를 관리함
- node_modules를 직접 설치하는 대신, 전역 저장소에서 패키지를 공유하는 구조를 사용함. pnpm이 패키지를 설치할 때, package.json에 명시된 패키지를 읽은 후 node_modules에 Symbolic Link를 생성하여 전역 저장소의 해당 패키지를 참조함.
